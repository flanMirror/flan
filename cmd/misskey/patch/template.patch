diff -ru cmd/misskey/assets/template/base.tmpl w/template/base.tmpl
--- cmd/misskey/assets/template/base.tmpl	2022-02-26 14:40:00.082935000 +0900
+++ w/template/base.tmpl	2022-02-22 18:31:28.255194000 +0900
@@ -1,14 +1,11 @@
-<!doctype html>{{ "<!--\n" }}{{ "  _____ _         _           \n" }}{{ " |     |_|___ ___| |_ ___ _ _ \n" }}{{ " | | | | |_ -|_ -| \'_| -_| | |\n" }}{{ " |_|_|_|_|___|___|_,_|___|_  |\n" }}{{ "                         |___|\n" }}{{ " Thank you for using Misskey!\n" }}{{ " If you are reading this message... how about joining the development?\n" }}{{ " https://github.com/misskey-dev/misskey" }}{{ "\n-->\n" }}<meta charset=utf-8><meta name=application-name content="Misskey"><meta name=referrer content="origin"><meta name=theme-color content="#86b300"><meta name=theme-color-orig content="#86b300"><meta property="og:site_name" content="{{ print instanceName || " misskey" }}"><meta name=viewport content="width=device-width,initial-scale=1"><link rel=icon href="{{ print icon ||" /favicon.ico" }}"><link rel=apple-touch-icon href="{{ print icon ||" /apple-touch-icon.png" }}"><link rel=manifest href=/manifest.json><link rel=prefetch href=https://xn--931a.moe/assets/info.jpg><link rel=prefetch href=https://xn--931a.moe/assets/not-found.jpg><link rel=prefetch href=https://xn--931a.moe/assets/error.jpg><link rel=preload href=https://use.fontawesome.com/releases/v5.15.3/css/all.css as=style><link rel=stylesheet href=https://use.fontawesome.com/releases/v5.15.3/css/all.css><title>{{ title || "Misskey" }}</title><meta name=description content="{{ print desc || " ✨🌎✨ a interplanetary communication platform ✨🚀✨" }}"><meta property="og:image" content="{{ print img }}"><style>html{background-color:var(--bg);color:var(--fg)}#splash{position:fixed;z-index:10000;top:0;left:0;width:100vw;height:100vh;cursor:wait;background-color:var(--bg);opacity:1;transition:opacity .5s ease}#splash>img{position:absolute;top:0;right:0;bottom:0;left:0;margin:auto;width:64px;height:64px;pointer-events:none}</style><script>'use strict';(async()=>{window.onerror=e=>{n("SOMETHING_HAPPENED",e.toString())},window.onunhandledrejection=e=>{n("SOMETHING_HAPPENED_IN_PROMISE",e.toString())};const t=localStorage.getItem("v")||VERSION,r=localStorage.getItem("localeVersion"),u=r==null||r!==t;if(!localStorage.hasOwnProperty("locale")||u){const s=LANGS;let e=localStorage.getItem("lang");(e==null||!s.includes(e))&&(s.includes(navigator.language)?e=navigator.language:(e=s.find(e=>e.split("-")[0]===navigator.language),e==null&&(e="en-US")));const o=await fetch(`/assets/locales/${e}.${t}.json`);if(o.status===200)localStorage.setItem("lang",e),localStorage.setItem("locale",await o.text()),localStorage.setItem("localeVersion",t);else{await a(),n("LOCALE_FETCH_FAILED");return}}const d=localStorage.getItem("salt")?`?salt=${localStorage.getItem("salt")}`:'',e=document.createElement("script");e.setAttribute("src",`/assets/app.${t}.js${d}`),e.setAttribute("async","true"),e.setAttribute("defer","true"),e.addEventListener("error",async()=>{await a(),n("APP_FETCH_FAILED")}),document.head.appendChild(e);const i=localStorage.getItem("theme");if(i)for(const[e,t]of Object.entries(JSON.parse(i)))if(document.documentElement.style.setProperty(`--${e}`,t.toString()),e==="htmlThemeColor")for(const e of document.head.children)if(e.tagName==="META"&&e.getAttribute("name")==="theme-color"){e.setAttribute("content",t);break}const o=localStorage.getItem("fontSize");o&&document.documentElement.classList.add("f-"+o);const l=localStorage.getItem("useSystemFont");l&&document.documentElement.classList.add("useSystemFont");const c=localStorage.getItem("wallpaper");c&&(document.documentElement.style.backgroundImage=`url(${c})`);const s=localStorage.getItem("customCss");if(s&&s.length>0){const e=document.createElement("style");e.innerHTML=s,document.head.appendChild(e)}function n(e,t){document.documentElement.innerHTML=`
-			<h1>⚠エラーが発生しました</h1>
-			<p>問題が解決しない場合は管理者までお問い合わせください。以下のオプションを試すこともできます:</p>
-			<ul>
-				<li><a href="/cli">簡易クライアント</a>を起動</li>
-				<li><a href="/bios">BIOS</a>で修復を試みる</li>
-				<li><a href="/flush">キャッシュをクリア</a>する</li>
-			</ul>
-			<hr>
-			<code>ERROR CODE: ${e}</code>
-			<details>
-				${t}
-			</details>
-		`}async function a(){const n=await fetch("/api/meta",{method:"POST",cache:"no-cache"}),e=await n.json();e.version!=t&&(localStorage.setItem("v",e.version),h())}function h(){localStorage.setItem("salt",Math.random().toString().substr(2,8));try{navigator.serviceWorker.controller.postMessage("clear"),navigator.serviceWorker.getRegistrations().then(e=>{e.forEach(e=>e.unregister())})}catch(e){console.error(e)}location.reload()}})()</script><noscript><p>JavaScriptを有効にしてください<br>Please turn on your JavaScript</p></noscript><div id=splash><img src=/favicon.ico></div>
\ No newline at end of file
+<!DOCTYPE html><!--
+  _____ _         _           
+ |     |_|___ ___| |_ ___ _ _ 
+ | | | | |_ -|_ -| '_| -_| | |
+ |_|_|_|_|___|___|_,_|___|_  |
+                         |___|
+ Thank you for using Misskey!
+ If you are reading this message... how about joining the development?
+ https://github.com/misskey-dev/misskey
+-->
+<html><head><meta charset="utf-8"><meta name="application-name" content="Misskey"><meta name="referrer" content="origin"><meta name="theme-color" content="#86b300"><meta name="theme-color-orig" content="#86b300"><meta property="og:site_name" content="{{.instanceName}}"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="{{.icon}}"><link rel="apple-touch-icon" href="{{.iconApple}}"><link rel="manifest" href="/manifest.json"><link rel="prefetch" href="https://xn--931a.moe/assets/info.jpg"><link rel="prefetch" href="https://xn--931a.moe/assets/not-found.jpg"><link rel="prefetch" href="https://xn--931a.moe/assets/error.jpg"><link rel="preload" href="https://use.fontawesome.com/releases/v5.15.3/css/all.css" as="style"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.3/css/all.css"><title>{{.instanceName}}</title><meta name="description" content="{{.description}}"><meta property="og:image" content="{{.banner}}"><style>html{background-color:var(--bg);color:var(--fg)}#splash{position:fixed;z-index:10000;top:0;left:0;width:100vw;height:100vh;cursor:wait;background-color:var(--bg);opacity:1;transition:opacity .5s ease}#splash>img{position:absolute;top:0;right:0;bottom:0;left:0;margin:auto;width:64px;height:64px;pointer-events:none}</style><script>"use strict";(async()=>{window.onerror=t=>{i("SOMETHING_HAPPENED",t.toString())},window.onunhandledrejection=t=>{i("SOMETHING_HAPPENED_IN_PROMISE",t.toString())};const t=localStorage.getItem("v")||"12.101.1",e=localStorage.getItem("localeVersion"),a=null==e||e!==t;if(!localStorage.hasOwnProperty("locale")||a){const e=["ar-SA","cs-CZ","da-DK","de-DE","en-US","eo-UY","es-ES","fr-FR","id-ID","it-IT","ja-JP","ja-KS","kab-KAB","kn-IN","ko-KR","nl-NL","no-NO","pl-PL","pt-PT","ru-RU","ug-CN","uk-UA","zh-CN","zh-TW"];let a=localStorage.getItem("lang");null!=a&&e.includes(a)||(e.includes(navigator.language)?a=navigator.language:(a=e.find((t=>t.split("-")[0]===navigator.language)),null==a&&(a="en-US")));const o=await fetch(`/assets/locales/${a}.${t}.json`);if(200!==o.status)return await g(),void i("LOCALE_FETCH_FAILED");localStorage.setItem("lang",a),localStorage.setItem("locale",await o.text()),localStorage.setItem("localeVersion",t)}const o=localStorage.getItem("salt")?`?salt=${localStorage.getItem("salt")}`:"",n=document.createElement("script");n.setAttribute("src",`/assets/app.${t}.js${o}`),n.setAttribute("async","true"),n.setAttribute("defer","true"),n.addEventListener("error",(async()=>{await g(),i("APP_FETCH_FAILED")})),document.head.appendChild(n);const l=localStorage.getItem("theme");if(l)for(const[t,e]of Object.entries(JSON.parse(l)))if(document.documentElement.style.setProperty(`--${t}`,e.toString()),"htmlThemeColor"===t)for(const t of document.head.children)if("META"===t.tagName&&"theme-color"===t.getAttribute("name")){t.setAttribute("content",e);break}const r=localStorage.getItem("fontSize");r&&document.documentElement.classList.add("f-"+r);localStorage.getItem("useSystemFont")&&document.documentElement.classList.add("useSystemFont");const c=localStorage.getItem("wallpaper");c&&(document.documentElement.style.backgroundImage=`url(${c})`);const s=localStorage.getItem("customCss");if(s&&s.length>0){const t=document.createElement("style");t.innerHTML=s,document.head.appendChild(t)}function i(t,e){document.documentElement.innerHTML=`\n\t\t\t<h1>⚠エラーが発生しました</h1>\n\t\t\t<p>問題が解決しない場合は管理者までお問い合わせください。以下のオプションを試すこともできます:</p>\n\t\t\t<ul>\n\t\t\t\t<li><a href="/cli">簡易クライアント</a>を起動</li>\n\t\t\t\t<li><a href="/bios">BIOS</a>で修復を試みる</li>\n\t\t\t\t<li><a href="/flush">キャッシュをクリア</a>する</li>\n\t\t\t</ul>\n\t\t\t<hr>\n\t\t\t<code>ERROR CODE: ${t}</code>\n\t\t\t<details>\n\t\t\t\t${e}\n\t\t\t</details>\n\t\t`}async function g(){const e=await fetch("/api/meta",{method:"POST",cache:"no-cache"}),a=await e.json();a.version!=t&&(localStorage.setItem("v",a.version),function(){localStorage.setItem("salt",Math.random().toString().substr(2,8));try{navigator.serviceWorker.controller.postMessage("clear"),navigator.serviceWorker.getRegistrations().then((t=>{t.forEach((t=>t.unregister()))}))}catch(t){console.error(t)}location.reload()}())}})();</script></head><body><noscript><p>JavaScriptを有効にしてください<br>Please turn on your JavaScript</p></noscript><div id="splash"><img src="/favicon.ico"></div></body></html>
\ No newline at end of file
diff -ru cmd/misskey/assets/template/bios.tmpl w/template/bios.tmpl
--- cmd/misskey/assets/template/bios.tmpl	2022-02-26 14:40:00.083597000 +0900
+++ w/template/bios.tmpl	2022-02-22 18:32:57.650849000 +0900
@@ -1 +1 @@
-<!doctype html><meta charset=utf-8><meta name=application-name content="Misskey"><title>Misskey BIOS</title><style>*{font-family:Fira code,Fira Mono,Consolas,Menlo,Courier,monospace}html{background:#ffb4e1}main{background:#dedede}main>.tabs{padding:16px;border-bottom:solid 4px #c3c3c3}#lsEditor>.adder{margin:16px;padding:16px;border:solid 2px #c3c3c3}#lsEditor>.adder>textarea{display:block;width:100%;min-height:5em;box-sizing:border-box}#lsEditor>.record{padding:16px;border-bottom:solid 1px #c3c3c3}#lsEditor>.record>header{font-weight:700}#lsEditor>.record>textarea{display:block;width:100%;min-height:5em;box-sizing:border-box}</style><script>'use strict';window.onload=async()=>{const n=JSON.parse(localStorage.getItem("account")),e=n.token,s=(t,n={})=>{const s=new Promise((s,o)=>{e&&(n.i=e),fetch(t.indexOf("://")>-1?t:`/api/${t}`,{method:"POST",body:JSON.stringify(n),credentials:"omit",cache:"no-cache"}).then(async e=>{const t=e.status===204?null:await e.json();e.status===200?s(t):e.status===204?s():o(t.error)}).catch(o)});return s},t=document.getElementById("content");document.getElementById("ls").addEventListener("click",()=>{t.innerHTML='';const n=document.createElement("div");n.id="lsEditor";const e=document.createElement("div");e.classList.add("adder");const o=document.createElement("input"),i=document.createElement("textarea"),s=document.createElement("button");s.textContent="add",s.addEventListener("click",()=>{localStorage.setItem(o.value,i.value),location.reload()}),e.appendChild(o),e.appendChild(i),e.appendChild(s),n.appendChild(e);for(let s=0;s<localStorage.length;s++){const t=localStorage.key(s),e=document.createElement("div");e.classList.add("record");const r=document.createElement("header");r.textContent=t;const o=document.createElement("textarea");o.textContent=localStorage.getItem(t);const i=document.createElement("button");i.textContent="save",i.addEventListener("click",()=>{localStorage.setItem(t,o.value),location.reload()});const a=document.createElement("button");a.textContent="remove",a.addEventListener("click",()=>{localStorage.removeItem(t),location.reload()}),e.appendChild(r),e.appendChild(o),e.appendChild(i),e.appendChild(a),n.appendChild(e)}t.appendChild(n)})}</script><header><h1>Misskey BIOS {{ version }}</h1></header><main><div class=tabs><button id=ls>edit local storage</button></div><div id=content></div></main>
\ No newline at end of file
+<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="application-name" content="Misskey"><title>Misskey BIOS</title><style>*{font-family:Fira code,Fira Mono,Consolas,Menlo,Courier,monospace}html{background:#ffb4e1}main{background:#dedede}main>.tabs{padding:16px;border-bottom:4px solid #c3c3c3}#lsEditor>.adder{margin:16px;padding:16px;border:2px solid #c3c3c3}#lsEditor>.adder>textarea{display:block;width:100%;min-height:5em;box-sizing:border-box}#lsEditor>.record{padding:16px;border-bottom:1px solid #c3c3c3}#lsEditor>.record>header{font-weight:700}#lsEditor>.record>textarea{display:block;width:100%;min-height:5em;box-sizing:border-box}</style><script>"use strict";window.onload=async()=>{JSON.parse(localStorage.getItem("account")).token;const e=document.getElementById("content");document.getElementById("ls").addEventListener("click",(()=>{e.innerHTML="";const t=document.createElement("div");t.id="lsEditor";const n=document.createElement("div");n.classList.add("adder");const a=document.createElement("input"),o=document.createElement("textarea"),d=document.createElement("button");d.textContent="add",d.addEventListener("click",(()=>{localStorage.setItem(a.value,o.value),location.reload()})),n.appendChild(a),n.appendChild(o),n.appendChild(d),t.appendChild(n);for(let e=0;e<localStorage.length;e++){const n=localStorage.key(e),a=document.createElement("div");a.classList.add("record");const o=document.createElement("header");o.textContent=n;const d=document.createElement("textarea");d.textContent=localStorage.getItem(n);const c=document.createElement("button");c.textContent="save",c.addEventListener("click",(()=>{localStorage.setItem(n,d.value),location.reload()}));const l=document.createElement("button");l.textContent="remove",l.addEventListener("click",(()=>{localStorage.removeItem(n),location.reload()})),a.appendChild(o),a.appendChild(d),a.appendChild(c),a.appendChild(l),t.appendChild(a)}e.appendChild(t)}))};</script></head><body><header><h1>Misskey BIOS {{.version}}</h1></header><main><div class="tabs"><button id="ls">edit local storage</button></div><div id="content"></div></main></body></html>
\ No newline at end of file
diff -ru cmd/misskey/assets/template/channel.tmpl w/template/channel.tmpl
--- cmd/misskey/assets/template/channel.tmpl	2022-02-26 14:40:00.084847000 +0900
+++ w/template/channel.tmpl	2022-02-22 18:41:30.917989000 +0900
@@ -1,14 +1,11 @@
-{{/* const title = channel.name; */}}{{/* const url = ``+config.url+`/channels/`+channel.id+``; */}}<!doctype html>{{ "<!--\n" }}{{ "  _____ _         _           \n" }}{{ " |     |_|___ ___| |_ ___ _ _ \n" }}{{ " | | | | |_ -|_ -| \'_| -_| | |\n" }}{{ " |_|_|_|_|___|___|_,_|___|_  |\n" }}{{ "                         |___|\n" }}{{ " Thank you for using Misskey!\n" }}{{ " If you are reading this message... how about joining the development?\n" }}{{ " https://github.com/misskey-dev/misskey" }}{{ "\n-->\n" }}<meta charset=utf-8><meta name=application-name content="Misskey"><meta name=referrer content="origin"><meta name=theme-color content="#86b300"><meta name=theme-color-orig content="#86b300"><meta property="og:site_name" content="{{ print instanceName || " misskey" }}"><meta name=viewport content="width=device-width,initial-scale=1"><link rel=icon href="{{ print icon ||" /favicon.ico" }}"><link rel=apple-touch-icon href="{{ print icon ||" /apple-touch-icon.png" }}"><link rel=manifest href=/manifest.json><link rel=prefetch href=https://xn--931a.moe/assets/info.jpg><link rel=prefetch href=https://xn--931a.moe/assets/not-found.jpg><link rel=prefetch href=https://xn--931a.moe/assets/error.jpg><link rel=preload href=https://use.fontawesome.com/releases/v5.15.3/css/all.css as=style><link rel=stylesheet href=https://use.fontawesome.com/releases/v5.15.3/css/all.css><title>{{ ``+title+` | `+instanceName+`` }}</title><meta name=description content="{{ print channel.description }}"><meta name=twitter:card content="summary"><meta property="og:type" content="article"><meta property="og:title" content="{{ print title }}"><meta property="og:description" content="{{ print channel.description }}"><meta property="og:url" content="{{ print url }}"><meta property="og:image" content="{{ print channel.bannerUrl }}"><style>html{background-color:var(--bg);color:var(--fg)}#splash{position:fixed;z-index:10000;top:0;left:0;width:100vw;height:100vh;cursor:wait;background-color:var(--bg);opacity:1;transition:opacity .5s ease}#splash>img{position:absolute;top:0;right:0;bottom:0;left:0;margin:auto;width:64px;height:64px;pointer-events:none}</style><script>'use strict';(async()=>{window.onerror=e=>{n("SOMETHING_HAPPENED",e.toString())},window.onunhandledrejection=e=>{n("SOMETHING_HAPPENED_IN_PROMISE",e.toString())};const t=localStorage.getItem("v")||VERSION,r=localStorage.getItem("localeVersion"),u=r==null||r!==t;if(!localStorage.hasOwnProperty("locale")||u){const s=LANGS;let e=localStorage.getItem("lang");(e==null||!s.includes(e))&&(s.includes(navigator.language)?e=navigator.language:(e=s.find(e=>e.split("-")[0]===navigator.language),e==null&&(e="en-US")));const o=await fetch(`/assets/locales/${e}.${t}.json`);if(o.status===200)localStorage.setItem("lang",e),localStorage.setItem("locale",await o.text()),localStorage.setItem("localeVersion",t);else{await a(),n("LOCALE_FETCH_FAILED");return}}const d=localStorage.getItem("salt")?`?salt=${localStorage.getItem("salt")}`:'',e=document.createElement("script");e.setAttribute("src",`/assets/app.${t}.js${d}`),e.setAttribute("async","true"),e.setAttribute("defer","true"),e.addEventListener("error",async()=>{await a(),n("APP_FETCH_FAILED")}),document.head.appendChild(e);const i=localStorage.getItem("theme");if(i)for(const[e,t]of Object.entries(JSON.parse(i)))if(document.documentElement.style.setProperty(`--${e}`,t.toString()),e==="htmlThemeColor")for(const e of document.head.children)if(e.tagName==="META"&&e.getAttribute("name")==="theme-color"){e.setAttribute("content",t);break}const o=localStorage.getItem("fontSize");o&&document.documentElement.classList.add("f-"+o);const l=localStorage.getItem("useSystemFont");l&&document.documentElement.classList.add("useSystemFont");const c=localStorage.getItem("wallpaper");c&&(document.documentElement.style.backgroundImage=`url(${c})`);const s=localStorage.getItem("customCss");if(s&&s.length>0){const e=document.createElement("style");e.innerHTML=s,document.head.appendChild(e)}function n(e,t){document.documentElement.innerHTML=`
-			<h1>⚠エラーが発生しました</h1>
-			<p>問題が解決しない場合は管理者までお問い合わせください。以下のオプションを試すこともできます:</p>
-			<ul>
-				<li><a href="/cli">簡易クライアント</a>を起動</li>
-				<li><a href="/bios">BIOS</a>で修復を試みる</li>
-				<li><a href="/flush">キャッシュをクリア</a>する</li>
-			</ul>
-			<hr>
-			<code>ERROR CODE: ${e}</code>
-			<details>
-				${t}
-			</details>
-		`}async function a(){const n=await fetch("/api/meta",{method:"POST",cache:"no-cache"}),e=await n.json();e.version!=t&&(localStorage.setItem("v",e.version),h())}function h(){localStorage.setItem("salt",Math.random().toString().substr(2,8));try{navigator.serviceWorker.controller.postMessage("clear"),navigator.serviceWorker.getRegistrations().then(e=>{e.forEach(e=>e.unregister())})}catch(e){console.error(e)}location.reload()}})()</script><noscript><p>JavaScriptを有効にしてください<br>Please turn on your JavaScript</p></noscript><div id=splash><img src=/favicon.ico></div>
\ No newline at end of file
+<!DOCTYPE html><!--
+  _____ _         _           
+ |     |_|___ ___| |_ ___ _ _ 
+ | | | | |_ -|_ -| '_| -_| | |
+ |_|_|_|_|___|___|_,_|___|_  |
+                         |___|
+ Thank you for using Misskey!
+ If you are reading this message... how about joining the development?
+ https://github.com/misskey-dev/misskey
+-->
+<html><head><meta charset="utf-8"><meta name="application-name" content="Misskey"><meta name="referrer" content="origin"><meta name="theme-color" content="#86b300"><meta name="theme-color-orig" content="#86b300"><meta property="og:site_name" content="{{.instanceName}}"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="{{.icon}}"><link rel="apple-touch-icon" href="{{.iconApple}}"><link rel="manifest" href="/manifest.json"><link rel="prefetch" href="https://xn--931a.moe/assets/info.jpg"><link rel="prefetch" href="https://xn--931a.moe/assets/not-found.jpg"><link rel="prefetch" href="https://xn--931a.moe/assets/error.jpg"><link rel="preload" href="https://use.fontawesome.com/releases/v5.15.3/css/all.css" as="style"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.3/css/all.css"><title>{{.channelName}} | {{.instanceName}}</title><meta name="description" content="{{.channelDescription}}"><meta name="twitter:card" content="summary"><meta property="og:type" content="article"><meta property="og:title" content="Deterministic Channel"><meta property="og:description" content="I have no idea how to write channel description but have to populate this field somehow..."><meta property="og:url" content="{{.url}}/channels/{{.channelID}}"><meta property="og:image" content="{{.channelBannerURL}}"><style>html{background-color:var(--bg);color:var(--fg)}#splash{position:fixed;z-index:10000;top:0;left:0;width:100vw;height:100vh;cursor:wait;background-color:var(--bg);opacity:1;transition:opacity .5s ease}#splash>img{position:absolute;top:0;right:0;bottom:0;left:0;margin:auto;width:64px;height:64px;pointer-events:none}</style><script>"use strict";(async()=>{window.onerror=t=>{i("SOMETHING_HAPPENED",t.toString())},window.onunhandledrejection=t=>{i("SOMETHING_HAPPENED_IN_PROMISE",t.toString())};const t=localStorage.getItem("v")||"12.101.1",e=localStorage.getItem("localeVersion"),a=null==e||e!==t;if(!localStorage.hasOwnProperty("locale")||a){const e=["ar-SA","cs-CZ","da-DK","de-DE","en-US","eo-UY","es-ES","fr-FR","id-ID","it-IT","ja-JP","ja-KS","kab-KAB","kn-IN","ko-KR","nl-NL","no-NO","pl-PL","pt-PT","ru-RU","ug-CN","uk-UA","zh-CN","zh-TW"];let a=localStorage.getItem("lang");null!=a&&e.includes(a)||(e.includes(navigator.language)?a=navigator.language:(a=e.find((t=>t.split("-")[0]===navigator.language)),null==a&&(a="en-US")));const o=await fetch(`/assets/locales/${a}.${t}.json`);if(200!==o.status)return await g(),void i("LOCALE_FETCH_FAILED");localStorage.setItem("lang",a),localStorage.setItem("locale",await o.text()),localStorage.setItem("localeVersion",t)}const o=localStorage.getItem("salt")?`?salt=${localStorage.getItem("salt")}`:"",n=document.createElement("script");n.setAttribute("src",`/assets/app.${t}.js${o}`),n.setAttribute("async","true"),n.setAttribute("defer","true"),n.addEventListener("error",(async()=>{await g(),i("APP_FETCH_FAILED")})),document.head.appendChild(n);const l=localStorage.getItem("theme");if(l)for(const[t,e]of Object.entries(JSON.parse(l)))if(document.documentElement.style.setProperty(`--${t}`,e.toString()),"htmlThemeColor"===t)for(const t of document.head.children)if("META"===t.tagName&&"theme-color"===t.getAttribute("name")){t.setAttribute("content",e);break}const r=localStorage.getItem("fontSize");r&&document.documentElement.classList.add("f-"+r);localStorage.getItem("useSystemFont")&&document.documentElement.classList.add("useSystemFont");const c=localStorage.getItem("wallpaper");c&&(document.documentElement.style.backgroundImage=`url(${c})`);const s=localStorage.getItem("customCss");if(s&&s.length>0){const t=document.createElement("style");t.innerHTML=s,document.head.appendChild(t)}function i(t,e){document.documentElement.innerHTML=`\n\t\t\t<h1>⚠エラーが発生しました</h1>\n\t\t\t<p>問題が解決しない場合は管理者までお問い合わせください。以下のオプションを試すこともできます:</p>\n\t\t\t<ul>\n\t\t\t\t<li><a href="/cli">簡易クライアント</a>を起動</li>\n\t\t\t\t<li><a href="/bios">BIOS</a>で修復を試みる</li>\n\t\t\t\t<li><a href="/flush">キャッシュをクリア</a>する</li>\n\t\t\t</ul>\n\t\t\t<hr>\n\t\t\t<code>ERROR CODE: ${t}</code>\n\t\t\t<details>\n\t\t\t\t${e}\n\t\t\t</details>\n\t\t`}async function g(){const e=await fetch("/api/meta",{method:"POST",cache:"no-cache"}),a=await e.json();a.version!=t&&(localStorage.setItem("v",a.version),function(){localStorage.setItem("salt",Math.random().toString().substr(2,8));try{navigator.serviceWorker.controller.postMessage("clear"),navigator.serviceWorker.getRegistrations().then((t=>{t.forEach((t=>t.unregister()))}))}catch(t){console.error(t)}location.reload()}())}})();</script></head><body><noscript><p>JavaScriptを有効にしてください<br>Please turn on your JavaScript</p></noscript><div id="splash"><img src="/favicon.ico"></div></body></html>
\ No newline at end of file
diff -ru cmd/misskey/assets/template/cli.tmpl w/template/cli.tmpl
--- cmd/misskey/assets/template/cli.tmpl	2022-02-26 14:40:00.085302000 +0900
+++ w/template/cli.tmpl	2022-02-22 22:34:04.474242000 +0900
@@ -1 +1 @@
-<!doctype html><meta charset=utf-8><meta name=application-name content="Misskey"><title>Misskey Cli</title><style>*{font-family:Fira code,Fira Mono,Consolas,Menlo,Courier,monospace}html{background:#ffb4e1}main{background:#dedede}#tl>div{padding:16px;border-bottom:solid 1px #c3c3c3}#tl>div>header{font-weight:700}</style><script>'use strict';window.onload=async()=>{const n=JSON.parse(localStorage.getItem("account")),e=n.token,t=(t,n={})=>{const s=new Promise((s,o)=>{e&&(n.i=e),fetch(t.indexOf("://")>-1?t:`/api/${t}`,{method:"POST",body:JSON.stringify(n),credentials:"omit",cache:"no-cache"}).then(async e=>{const t=e.status===204?null:await e.json();e.status===200?s(t):e.status===204?s():o(t.error)}).catch(o)});return s};document.getElementById("submit").addEventListener("click",()=>{t("notes/create",{text:document.getElementById("text").value}).then(()=>{location.reload()})}),t("notes/timeline").then(e=>{const t=document.getElementById("tl");for(const n of e){const s=document.createElement("div"),o=document.createElement("header");o.textContent=`${n.user.name} @${n.user.username}`;const i=document.createElement("div");i.textContent=`${n.text}`,s.appendChild(o),s.appendChild(i),t.appendChild(s)}})}</script><header><h1>Misskey Cli {{ version }}</h1></header><main><div id=form><textarea id=text></textarea><button id=submit>submit</button></div><div id=tl></div></main>
\ No newline at end of file
+<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="application-name" content="Misskey"><title>Misskey Cli</title><style>*{font-family:Fira code,Fira Mono,Consolas,Menlo,Courier,monospace}html{background:#ffb4e1}main{background:#dedede}#tl>div{padding:16px;border-bottom:1px solid #c3c3c3}#tl>div>header{font-weight:700}</style><script>"use strict";window.onload=async()=>{const e=JSON.parse(localStorage.getItem("account")).token,t=(t,n={})=>new Promise(((o,c)=>{e&&(n.i=e),fetch(t.indexOf("://")>-1?t:`/api/${t}`,{method:"POST",body:JSON.stringify(n),credentials:"omit",cache:"no-cache"}).then((async e=>{const t=204===e.status?null:await e.json();200===e.status?o(t):204===e.status?o():c(t.error)})).catch(c)}));document.getElementById("submit").addEventListener("click",(()=>{t("notes/create",{text:document.getElementById("text").value}).then((()=>{location.reload()}))})),t("notes/timeline").then((e=>{const t=document.getElementById("tl");for(const n of e){const e=document.createElement("div"),o=document.createElement("header");o.textContent=`${n.user.name} @${n.user.username}`;const c=document.createElement("div");c.textContent=`${n.text}`,e.appendChild(o),e.appendChild(c),t.appendChild(e)}}))};</script></head><body><header><h1>Misskey Cli {{.version}}</h1></header><main><div id="form"><textarea id="text"></textarea><button id="submit">submit</button></div><div id="tl"></div></main></body></html>
\ No newline at end of file
diff -ru cmd/misskey/assets/template/clip.tmpl w/template/clip.tmpl
--- cmd/misskey/assets/template/clip.tmpl	2022-02-26 14:40:00.086419000 +0900
+++ w/template/clip.tmpl	2022-02-23 11:23:50.268582000 +0900
@@ -1,14 +1,11 @@
-{{/* const user = clip.user; */}}{{/* const title = clip.name; */}}{{/* const url = ``+config.url+`/clips/`+clip.id+``; */}}<!doctype html>{{ "<!--\n" }}{{ "  _____ _         _           \n" }}{{ " |     |_|___ ___| |_ ___ _ _ \n" }}{{ " | | | | |_ -|_ -| \'_| -_| | |\n" }}{{ " |_|_|_|_|___|___|_,_|___|_  |\n" }}{{ "                         |___|\n" }}{{ " Thank you for using Misskey!\n" }}{{ " If you are reading this message... how about joining the development?\n" }}{{ " https://github.com/misskey-dev/misskey" }}{{ "\n-->\n" }}<meta charset=utf-8><meta name=application-name content="Misskey"><meta name=referrer content="origin"><meta name=theme-color content="#86b300"><meta name=theme-color-orig content="#86b300"><meta property="og:site_name" content="{{ print instanceName || " misskey" }}"><meta name=viewport content="width=device-width,initial-scale=1"><link rel=icon href="{{ print icon ||" /favicon.ico" }}"><link rel=apple-touch-icon href="{{ print icon ||" /apple-touch-icon.png" }}"><link rel=manifest href=/manifest.json><link rel=prefetch href=https://xn--931a.moe/assets/info.jpg><link rel=prefetch href=https://xn--931a.moe/assets/not-found.jpg><link rel=prefetch href=https://xn--931a.moe/assets/error.jpg><link rel=preload href=https://use.fontawesome.com/releases/v5.15.3/css/all.css as=style><link rel=stylesheet href=https://use.fontawesome.com/releases/v5.15.3/css/all.css><title>{{ ``+title+` | `+instanceName+`` }}</title><meta name=description content="{{ print clip.description }}">{{ if profile.noCrawle }}<meta name=robots content="noindex">{{ end }}<meta name=misskey:user-username content="{{ print user.username }}"><meta name=misskey:user-id content="{{ print user.id }}"><meta name=misskey:clip-id content="{{ print clip.id }}"><meta name=twitter:card content="summary"><!-- todo -->{{ if user.twitter }}<meta name=twitter:creator content="{{ print `@`+user.twitter.screenName+`` }}">{{ end }}<meta property="og:type" content="article"><meta property="og:title" content="{{ print title }}"><meta property="og:description" content="{{ print clip.description }}"><meta property="og:url" content="{{ print url }}"><meta property="og:image" content="{{ print user.avatarUrl }}"><style>html{background-color:var(--bg);color:var(--fg)}#splash{position:fixed;z-index:10000;top:0;left:0;width:100vw;height:100vh;cursor:wait;background-color:var(--bg);opacity:1;transition:opacity .5s ease}#splash>img{position:absolute;top:0;right:0;bottom:0;left:0;margin:auto;width:64px;height:64px;pointer-events:none}</style><script>'use strict';(async()=>{window.onerror=e=>{n("SOMETHING_HAPPENED",e.toString())},window.onunhandledrejection=e=>{n("SOMETHING_HAPPENED_IN_PROMISE",e.toString())};const t=localStorage.getItem("v")||VERSION,r=localStorage.getItem("localeVersion"),u=r==null||r!==t;if(!localStorage.hasOwnProperty("locale")||u){const s=LANGS;let e=localStorage.getItem("lang");(e==null||!s.includes(e))&&(s.includes(navigator.language)?e=navigator.language:(e=s.find(e=>e.split("-")[0]===navigator.language),e==null&&(e="en-US")));const o=await fetch(`/assets/locales/${e}.${t}.json`);if(o.status===200)localStorage.setItem("lang",e),localStorage.setItem("locale",await o.text()),localStorage.setItem("localeVersion",t);else{await a(),n("LOCALE_FETCH_FAILED");return}}const d=localStorage.getItem("salt")?`?salt=${localStorage.getItem("salt")}`:'',e=document.createElement("script");e.setAttribute("src",`/assets/app.${t}.js${d}`),e.setAttribute("async","true"),e.setAttribute("defer","true"),e.addEventListener("error",async()=>{await a(),n("APP_FETCH_FAILED")}),document.head.appendChild(e);const i=localStorage.getItem("theme");if(i)for(const[e,t]of Object.entries(JSON.parse(i)))if(document.documentElement.style.setProperty(`--${e}`,t.toString()),e==="htmlThemeColor")for(const e of document.head.children)if(e.tagName==="META"&&e.getAttribute("name")==="theme-color"){e.setAttribute("content",t);break}const o=localStorage.getItem("fontSize");o&&document.documentElement.classList.add("f-"+o);const l=localStorage.getItem("useSystemFont");l&&document.documentElement.classList.add("useSystemFont");const c=localStorage.getItem("wallpaper");c&&(document.documentElement.style.backgroundImage=`url(${c})`);const s=localStorage.getItem("customCss");if(s&&s.length>0){const e=document.createElement("style");e.innerHTML=s,document.head.appendChild(e)}function n(e,t){document.documentElement.innerHTML=`
-			<h1>⚠エラーが発生しました</h1>
-			<p>問題が解決しない場合は管理者までお問い合わせください。以下のオプションを試すこともできます:</p>
-			<ul>
-				<li><a href="/cli">簡易クライアント</a>を起動</li>
-				<li><a href="/bios">BIOS</a>で修復を試みる</li>
-				<li><a href="/flush">キャッシュをクリア</a>する</li>
-			</ul>
-			<hr>
-			<code>ERROR CODE: ${e}</code>
-			<details>
-				${t}
-			</details>
-		`}async function a(){const n=await fetch("/api/meta",{method:"POST",cache:"no-cache"}),e=await n.json();e.version!=t&&(localStorage.setItem("v",e.version),h())}function h(){localStorage.setItem("salt",Math.random().toString().substr(2,8));try{navigator.serviceWorker.controller.postMessage("clear"),navigator.serviceWorker.getRegistrations().then(e=>{e.forEach(e=>e.unregister())})}catch(e){console.error(e)}location.reload()}})()</script><noscript><p>JavaScriptを有効にしてください<br>Please turn on your JavaScript</p></noscript><div id=splash><img src=/favicon.ico></div>
\ No newline at end of file
+<!DOCTYPE html><!--
+  _____ _         _           
+ |     |_|___ ___| |_ ___ _ _ 
+ | | | | |_ -|_ -| '_| -_| | |
+ |_|_|_|_|___|___|_,_|___|_  |
+                         |___|
+ Thank you for using Misskey!
+ If you are reading this message... how about joining the development?
+ https://github.com/misskey-dev/misskey
+-->
+<html><head><meta charset="utf-8"><meta name="application-name" content="Misskey"><meta name="referrer" content="origin"><meta name="theme-color" content="#86b300"><meta name="theme-color-orig" content="#86b300"><meta property="og:site_name" content="{{.instanceName}}"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="{{.icon}}"><link rel="apple-touch-icon" href="{{.iconApple}}"><link rel="manifest" href="/manifest.json"><link rel="prefetch" href="https://xn--931a.moe/assets/info.jpg"><link rel="prefetch" href="https://xn--931a.moe/assets/not-found.jpg"><link rel="prefetch" href="https://xn--931a.moe/assets/error.jpg"><link rel="preload" href="https://use.fontawesome.com/releases/v5.15.3/css/all.css" as="style"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.3/css/all.css"><title>{{.clipName}} | {{.instanceName}}</title><meta name="description" content="{{.clipDescription}}">{{if .noIndex}}<meta name="robots" content="noindex"/>{{end}}<meta name="misskey:user-username" content="{{.userUsername}}"><meta name="misskey:user-id" content="{{.userID}}"><meta name="misskey:clip-id" content="{{.clipID}}"><meta name="twitter:card" content="summary"><!-- todo-->{{if .userTwitterExists}}<meta name="twitter:creator" content="@{{.userTwitterScreenName}}"/>{{end}}<meta property="og:type" content="article"><meta property="og:title" content="{{.clipName}}"><meta property="og:description" content="{{.clipDescription}}"><meta property="og:url" content="{{.url}}/clips/{{.clipID}}"><meta property="og:image" content="{{.userAvatarURL}}"><style>html{background-color:var(--bg);color:var(--fg)}#splash{position:fixed;z-index:10000;top:0;left:0;width:100vw;height:100vh;cursor:wait;background-color:var(--bg);opacity:1;transition:opacity .5s ease}#splash>img{position:absolute;top:0;right:0;bottom:0;left:0;margin:auto;width:64px;height:64px;pointer-events:none}</style><script>"use strict";(async()=>{window.onerror=t=>{i("SOMETHING_HAPPENED",t.toString())},window.onunhandledrejection=t=>{i("SOMETHING_HAPPENED_IN_PROMISE",t.toString())};const t=localStorage.getItem("v")||"12.101.1",e=localStorage.getItem("localeVersion"),a=null==e||e!==t;if(!localStorage.hasOwnProperty("locale")||a){const e=["ar-SA","cs-CZ","da-DK","de-DE","en-US","eo-UY","es-ES","fr-FR","id-ID","it-IT","ja-JP","ja-KS","kab-KAB","kn-IN","ko-KR","nl-NL","no-NO","pl-PL","pt-PT","ru-RU","ug-CN","uk-UA","zh-CN","zh-TW"];let a=localStorage.getItem("lang");null!=a&&e.includes(a)||(e.includes(navigator.language)?a=navigator.language:(a=e.find((t=>t.split("-")[0]===navigator.language)),null==a&&(a="en-US")));const o=await fetch(`/assets/locales/${a}.${t}.json`);if(200!==o.status)return await g(),void i("LOCALE_FETCH_FAILED");localStorage.setItem("lang",a),localStorage.setItem("locale",await o.text()),localStorage.setItem("localeVersion",t)}const o=localStorage.getItem("salt")?`?salt=${localStorage.getItem("salt")}`:"",n=document.createElement("script");n.setAttribute("src",`/assets/app.${t}.js${o}`),n.setAttribute("async","true"),n.setAttribute("defer","true"),n.addEventListener("error",(async()=>{await g(),i("APP_FETCH_FAILED")})),document.head.appendChild(n);const l=localStorage.getItem("theme");if(l)for(const[t,e]of Object.entries(JSON.parse(l)))if(document.documentElement.style.setProperty(`--${t}`,e.toString()),"htmlThemeColor"===t)for(const t of document.head.children)if("META"===t.tagName&&"theme-color"===t.getAttribute("name")){t.setAttribute("content",e);break}const r=localStorage.getItem("fontSize");r&&document.documentElement.classList.add("f-"+r);localStorage.getItem("useSystemFont")&&document.documentElement.classList.add("useSystemFont");const c=localStorage.getItem("wallpaper");c&&(document.documentElement.style.backgroundImage=`url(${c})`);const s=localStorage.getItem("customCss");if(s&&s.length>0){const t=document.createElement("style");t.innerHTML=s,document.head.appendChild(t)}function i(t,e){document.documentElement.innerHTML=`\n\t\t\t<h1>⚠エラーが発生しました</h1>\n\t\t\t<p>問題が解決しない場合は管理者までお問い合わせください。以下のオプションを試すこともできます:</p>\n\t\t\t<ul>\n\t\t\t\t<li><a href="/cli">簡易クライアント</a>を起動</li>\n\t\t\t\t<li><a href="/bios">BIOS</a>で修復を試みる</li>\n\t\t\t\t<li><a href="/flush">キャッシュをクリア</a>する</li>\n\t\t\t</ul>\n\t\t\t<hr>\n\t\t\t<code>ERROR CODE: ${t}</code>\n\t\t\t<details>\n\t\t\t\t${e}\n\t\t\t</details>\n\t\t`}async function g(){const e=await fetch("/api/meta",{method:"POST",cache:"no-cache"}),a=await e.json();a.version!=t&&(localStorage.setItem("v",a.version),function(){localStorage.setItem("salt",Math.random().toString().substr(2,8));try{navigator.serviceWorker.controller.postMessage("clear"),navigator.serviceWorker.getRegistrations().then((t=>{t.forEach((t=>t.unregister()))}))}catch(t){console.error(t)}location.reload()}())}})();</script></head><body><noscript><p>JavaScriptを有効にしてください<br>Please turn on your JavaScript</p></noscript><div id="splash"><img src="/favicon.ico"></div></body></html>
\ No newline at end of file
diff -ru cmd/misskey/assets/template/flush.tmpl w/template/flush.tmpl
--- cmd/misskey/assets/template/flush.tmpl	2022-02-26 14:40:00.086733000 +0900
+++ w/template/flush.tmpl	2022-02-22 23:36:19.415478000 +0900
@@ -1 +1,42 @@
-<!doctype html><div id=msg></div><script>const msg=document.getElementById("msg"),successText=`\nSuccess Flush! <a href="/">Back to Misskey</a>\n成功しました。<a href="/">Misskeyを開き直してください。</a>`;message("Start flushing."),async function(){try{localStorage.clear(),message("localStorage cleared.");const e=["MisskeyClient","keyval-store"].map((e,t,n)=>new Promise((o,i)=>{const s=indexedDB.deleteDatabase(e);s.onsuccess=()=>o(message(`indexedDB "${e}" cleared. (${t+1}/${n.length})`)),s.onerror=e=>i(e)}));await Promise.all(e),navigator.serviceWorker.controller&&(navigator.serviceWorker.controller.postMessage("clear"),await navigator.serviceWorker.getRegistrations().then(e=>Promise.all(e.map(e=>e.unregister()))).catch(e=>{throw Error(e)})),message(successText)}catch(e){message(`\n${e}\n\nFlush Failed. <a href="/flush">Please retry.</a>\n失敗しました。<a href="/flush">もう一度試してみてください。</a>`),message(`\nIf you retry more than 3 times, clear the browser cache or contact to instance admin.\n3回以上試しても失敗する場合、ブラウザのキャッシュを消去し、それでもだめならインスタンス管理者に連絡してみてください。\n`),console.error(e),setTimeout(()=>{location="/"},1e4)}}();function message(e){msg.insertAdjacentHTML("beforeend",`<p>[${(new Date).toString()}] ${e.replace(/\n/g,"<br>")}</p>`)}</script>
\ No newline at end of file
+<!DOCTYPE html><html><div id="msg"></div><script>const msg = document.getElementById('msg');
+const successText = `\nSuccess Flush! <a href="/">Back to Misskey</a>\n成功しました。<a href="/">Misskeyを開き直してください。</a>`;
+
+message('Start flushing.');
+
+(async function() {
+	try {
+		localStorage.clear();
+		message('localStorage cleared.');
+
+		const idbPromises = ['MisskeyClient', 'keyval-store'].map((name, i, arr) => new Promise((res, rej) => {
+			const delidb = indexedDB.deleteDatabase(name);
+			delidb.onsuccess = () => res(message(`indexedDB "${name}" cleared. (${i + 1}/${arr.length})`));
+			delidb.onerror = e => rej(e)
+		}));
+
+		await Promise.all(idbPromises);
+
+		if (navigator.serviceWorker.controller) {
+			navigator.serviceWorker.controller.postMessage('clear');
+			await navigator.serviceWorker.getRegistrations()
+				.then(registrations => {
+					return Promise.all(registrations.map(registration => registration.unregister()));
+				})
+				.catch(e => { throw Error(e) });
+		}
+
+		message(successText);
+	} catch (e) {
+		message(`\n${e}\n\nFlush Failed. <a href="/flush">Please retry.</a>\n失敗しました。<a href="/flush">もう一度試してみてください。</a>`);
+		message(`\nIf you retry more than 3 times, clear the browser cache or contact to instance admin.\n3回以上試しても失敗する場合、ブラウザのキャッシュを消去し、それでもだめならインスタンス管理者に連絡してみてください。\n`)
+
+		console.error(e);
+		setTimeout(() => {
+			location = '/';
+		}, 10000)
+	}
+})();
+
+function message(text) {
+	msg.insertAdjacentHTML('beforeend', `<p>[${(new Date()).toString()}] ${text.replace(/\n/g,'<br>')}</p>`)
+}</script></html>
\ No newline at end of file
diff -ru cmd/misskey/assets/template/gallery-post.tmpl w/template/gallery-post.tmpl
--- cmd/misskey/assets/template/gallery-post.tmpl	2022-02-26 14:40:00.087882000 +0900
+++ w/template/gallery-post.tmpl	2022-02-25 12:16:26.507988000 +0900
@@ -1,14 +1,11 @@
-{{/* const user = post.user; */}}{{/* const title = post.title; */}}{{/* const url = ``+config.url+`/gallery/`+post.id+``; */}}<!doctype html>{{ "<!--\n" }}{{ "  _____ _         _           \n" }}{{ " |     |_|___ ___| |_ ___ _ _ \n" }}{{ " | | | | |_ -|_ -| \'_| -_| | |\n" }}{{ " |_|_|_|_|___|___|_,_|___|_  |\n" }}{{ "                         |___|\n" }}{{ " Thank you for using Misskey!\n" }}{{ " If you are reading this message... how about joining the development?\n" }}{{ " https://github.com/misskey-dev/misskey" }}{{ "\n-->\n" }}<meta charset=utf-8><meta name=application-name content="Misskey"><meta name=referrer content="origin"><meta name=theme-color content="#86b300"><meta name=theme-color-orig content="#86b300"><meta property="og:site_name" content="{{ print instanceName || " misskey" }}"><meta name=viewport content="width=device-width,initial-scale=1"><link rel=icon href="{{ print icon ||" /favicon.ico" }}"><link rel=apple-touch-icon href="{{ print icon ||" /apple-touch-icon.png" }}"><link rel=manifest href=/manifest.json><link rel=prefetch href=https://xn--931a.moe/assets/info.jpg><link rel=prefetch href=https://xn--931a.moe/assets/not-found.jpg><link rel=prefetch href=https://xn--931a.moe/assets/error.jpg><link rel=preload href=https://use.fontawesome.com/releases/v5.15.3/css/all.css as=style><link rel=stylesheet href=https://use.fontawesome.com/releases/v5.15.3/css/all.css><title>{{ ``+title+` | `+instanceName+`` }}</title><meta name=description content="{{ print post.description }}">{{ if user.host || profile.noCrawle }}<meta name=robots content="noindex">{{ end }}<meta name=misskey:user-username content="{{ print user.username }}"><meta name=misskey:user-id content="{{ print user.id }}"><meta name=twitter:card content="summary"><!-- todo -->{{ if user.twitter }}<meta name=twitter:creator content="{{ print `@`+user.twitter.screenName+`` }}">{{ end }}{{ if !user.host }}<link rel=alternate href="{{ print url }}" type=application/activity+json>{{ end }}<meta property="og:type" content="article"><meta property="og:title" content="{{ print title }}"><meta property="og:description" content="{{ print post.description }}"><meta property="og:url" content="{{ print url }}"><meta property="og:image" content="{{ print post.files[0].thumbnailUrl }}"><style>html{background-color:var(--bg);color:var(--fg)}#splash{position:fixed;z-index:10000;top:0;left:0;width:100vw;height:100vh;cursor:wait;background-color:var(--bg);opacity:1;transition:opacity .5s ease}#splash>img{position:absolute;top:0;right:0;bottom:0;left:0;margin:auto;width:64px;height:64px;pointer-events:none}</style><script>'use strict';(async()=>{window.onerror=e=>{n("SOMETHING_HAPPENED",e.toString())},window.onunhandledrejection=e=>{n("SOMETHING_HAPPENED_IN_PROMISE",e.toString())};const t=localStorage.getItem("v")||VERSION,r=localStorage.getItem("localeVersion"),u=r==null||r!==t;if(!localStorage.hasOwnProperty("locale")||u){const s=LANGS;let e=localStorage.getItem("lang");(e==null||!s.includes(e))&&(s.includes(navigator.language)?e=navigator.language:(e=s.find(e=>e.split("-")[0]===navigator.language),e==null&&(e="en-US")));const o=await fetch(`/assets/locales/${e}.${t}.json`);if(o.status===200)localStorage.setItem("lang",e),localStorage.setItem("locale",await o.text()),localStorage.setItem("localeVersion",t);else{await a(),n("LOCALE_FETCH_FAILED");return}}const d=localStorage.getItem("salt")?`?salt=${localStorage.getItem("salt")}`:'',e=document.createElement("script");e.setAttribute("src",`/assets/app.${t}.js${d}`),e.setAttribute("async","true"),e.setAttribute("defer","true"),e.addEventListener("error",async()=>{await a(),n("APP_FETCH_FAILED")}),document.head.appendChild(e);const i=localStorage.getItem("theme");if(i)for(const[e,t]of Object.entries(JSON.parse(i)))if(document.documentElement.style.setProperty(`--${e}`,t.toString()),e==="htmlThemeColor")for(const e of document.head.children)if(e.tagName==="META"&&e.getAttribute("name")==="theme-color"){e.setAttribute("content",t);break}const o=localStorage.getItem("fontSize");o&&document.documentElement.classList.add("f-"+o);const l=localStorage.getItem("useSystemFont");l&&document.documentElement.classList.add("useSystemFont");const c=localStorage.getItem("wallpaper");c&&(document.documentElement.style.backgroundImage=`url(${c})`);const s=localStorage.getItem("customCss");if(s&&s.length>0){const e=document.createElement("style");e.innerHTML=s,document.head.appendChild(e)}function n(e,t){document.documentElement.innerHTML=`
-			<h1>⚠エラーが発生しました</h1>
-			<p>問題が解決しない場合は管理者までお問い合わせください。以下のオプションを試すこともできます:</p>
-			<ul>
-				<li><a href="/cli">簡易クライアント</a>を起動</li>
-				<li><a href="/bios">BIOS</a>で修復を試みる</li>
-				<li><a href="/flush">キャッシュをクリア</a>する</li>
-			</ul>
-			<hr>
-			<code>ERROR CODE: ${e}</code>
-			<details>
-				${t}
-			</details>
-		`}async function a(){const n=await fetch("/api/meta",{method:"POST",cache:"no-cache"}),e=await n.json();e.version!=t&&(localStorage.setItem("v",e.version),h())}function h(){localStorage.setItem("salt",Math.random().toString().substr(2,8));try{navigator.serviceWorker.controller.postMessage("clear"),navigator.serviceWorker.getRegistrations().then(e=>{e.forEach(e=>e.unregister())})}catch(e){console.error(e)}location.reload()}})()</script><noscript><p>JavaScriptを有効にしてください<br>Please turn on your JavaScript</p></noscript><div id=splash><img src=/favicon.ico></div>
\ No newline at end of file
+<!DOCTYPE html><!--
+  _____ _         _           
+ |     |_|___ ___| |_ ___ _ _ 
+ | | | | |_ -|_ -| '_| -_| | |
+ |_|_|_|_|___|___|_,_|___|_  |
+                         |___|
+ Thank you for using Misskey!
+ If you are reading this message... how about joining the development?
+ https://github.com/misskey-dev/misskey
+-->
+<html><head><meta charset="utf-8"><meta name="application-name" content="Misskey"><meta name="referrer" content="origin"><meta name="theme-color" content="#86b300"><meta name="theme-color-orig" content="#86b300"><meta property="og:site_name" content="{{.instanceName}}"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="{{.icon}}"><link rel="apple-touch-icon" href="{{.iconApple}}"><link rel="manifest" href="/manifest.json"><link rel="prefetch" href="https://xn--931a.moe/assets/info.jpg"><link rel="prefetch" href="https://xn--931a.moe/assets/not-found.jpg"><link rel="prefetch" href="https://xn--931a.moe/assets/error.jpg"><link rel="preload" href="https://use.fontawesome.com/releases/v5.15.3/css/all.css" as="style"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.3/css/all.css"><title>{{.postTitle}} | {{.instanceName}}</title><meta name="description" content="{{.postDescription}}">{{if .noIndex}}<meta name="robots" content="noindex"/>{{end}}<meta name="misskey:user-username" content="{{.userUsername}}"><meta name="misskey:user-id" content="{{.userID}}"><meta name="twitter:card" content="summary"><!-- todo-->{{if .userTwitterExists}}<meta name="twitter:creator" content="@{{.userTwitterScreenName}}"/>{{end}}{{if .localUser}}<link rel="alternate" href="{{.url}}/gallery/{{.postID}}" type="application/activity+json">{{end}}<meta property="og:type" content="article"><meta property="og:title" content="{{.postTitle}}"><meta property="og:description" content="{{.postDescription}}"><meta property="og:url" content="{{.url}}/gallery/{{.postID}}"><meta property="og:image" content="{{(index .postFiles 0).thumbnailUrl}}"><style>html{background-color:var(--bg);color:var(--fg)}#splash{position:fixed;z-index:10000;top:0;left:0;width:100vw;height:100vh;cursor:wait;background-color:var(--bg);opacity:1;transition:opacity .5s ease}#splash>img{position:absolute;top:0;right:0;bottom:0;left:0;margin:auto;width:64px;height:64px;pointer-events:none}</style><script>"use strict";(async()=>{window.onerror=t=>{i("SOMETHING_HAPPENED",t.toString())},window.onunhandledrejection=t=>{i("SOMETHING_HAPPENED_IN_PROMISE",t.toString())};const t=localStorage.getItem("v")||"12.101.1",e=localStorage.getItem("localeVersion"),a=null==e||e!==t;if(!localStorage.hasOwnProperty("locale")||a){const e=["ar-SA","cs-CZ","da-DK","de-DE","en-US","eo-UY","es-ES","fr-FR","id-ID","it-IT","ja-JP","ja-KS","kab-KAB","kn-IN","ko-KR","nl-NL","no-NO","pl-PL","pt-PT","ru-RU","ug-CN","uk-UA","zh-CN","zh-TW"];let a=localStorage.getItem("lang");null!=a&&e.includes(a)||(e.includes(navigator.language)?a=navigator.language:(a=e.find((t=>t.split("-")[0]===navigator.language)),null==a&&(a="en-US")));const o=await fetch(`/assets/locales/${a}.${t}.json`);if(200!==o.status)return await g(),void i("LOCALE_FETCH_FAILED");localStorage.setItem("lang",a),localStorage.setItem("locale",await o.text()),localStorage.setItem("localeVersion",t)}const o=localStorage.getItem("salt")?`?salt=${localStorage.getItem("salt")}`:"",n=document.createElement("script");n.setAttribute("src",`/assets/app.${t}.js${o}`),n.setAttribute("async","true"),n.setAttribute("defer","true"),n.addEventListener("error",(async()=>{await g(),i("APP_FETCH_FAILED")})),document.head.appendChild(n);const l=localStorage.getItem("theme");if(l)for(const[t,e]of Object.entries(JSON.parse(l)))if(document.documentElement.style.setProperty(`--${t}`,e.toString()),"htmlThemeColor"===t)for(const t of document.head.children)if("META"===t.tagName&&"theme-color"===t.getAttribute("name")){t.setAttribute("content",e);break}const r=localStorage.getItem("fontSize");r&&document.documentElement.classList.add("f-"+r);localStorage.getItem("useSystemFont")&&document.documentElement.classList.add("useSystemFont");const c=localStorage.getItem("wallpaper");c&&(document.documentElement.style.backgroundImage=`url(${c})`);const s=localStorage.getItem("customCss");if(s&&s.length>0){const t=document.createElement("style");t.innerHTML=s,document.head.appendChild(t)}function i(t,e){document.documentElement.innerHTML=`\n\t\t\t<h1>⚠エラーが発生しました</h1>\n\t\t\t<p>問題が解決しない場合は管理者までお問い合わせください。以下のオプションを試すこともできます:</p>\n\t\t\t<ul>\n\t\t\t\t<li><a href="/cli">簡易クライアント</a>を起動</li>\n\t\t\t\t<li><a href="/bios">BIOS</a>で修復を試みる</li>\n\t\t\t\t<li><a href="/flush">キャッシュをクリア</a>する</li>\n\t\t\t</ul>\n\t\t\t<hr>\n\t\t\t<code>ERROR CODE: ${t}</code>\n\t\t\t<details>\n\t\t\t\t${e}\n\t\t\t</details>\n\t\t`}async function g(){const e=await fetch("/api/meta",{method:"POST",cache:"no-cache"}),a=await e.json();a.version!=t&&(localStorage.setItem("v",a.version),function(){localStorage.setItem("salt",Math.random().toString().substr(2,8));try{navigator.serviceWorker.controller.postMessage("clear"),navigator.serviceWorker.getRegistrations().then((t=>{t.forEach((t=>t.unregister()))}))}catch(t){console.error(t)}location.reload()}())}})();</script></head><body><noscript><p>JavaScriptを有効にしてください<br>Please turn on your JavaScript</p></noscript><div id="splash"><img src="/favicon.ico"></div></body></html>
\ No newline at end of file
diff -ru cmd/misskey/assets/template/info-card.tmpl w/template/info-card.tmpl
--- cmd/misskey/assets/template/info-card.tmpl	2022-02-26 14:40:00.088152000 +0900
+++ w/template/info-card.tmpl	2022-02-22 23:40:24.238861000 +0900
@@ -1 +1,35 @@
-<!doctype html><meta charset=utf-8><meta name=application-name content="Misskey"><title>{{ meta.name || host }}</title><style>html,body{margin:0;padding:0;min-height:100vh;background:#fff}#a{display:block}#banner{background-size:cover;background-position:50%}#title{display:inline-block;margin:24px;padding:.5em .8em;color:#fff;background:rgba(0,0,0,.5);font-weight:700;font-size:1.3em}#content{overflow:auto;color:#353c3e}#description{margin:24px}</style><a id=a href="{{ print `https://`+host+`` }}" target=_blank><header id=banner style="{{ print `background-image: url(`+meta.bannerUrl+`)` }}"><div id=title>{{ meta.name || host }}</div></header></a><div id=content><div id=description>{{ meta.description }}</div></div>
\ No newline at end of file
+<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="application-name" content="Misskey"><title>{{.instanceName}}</title><style>html, body {
+	margin: 0;
+	padding: 0;
+	min-height: 100vh;
+	background: #fff;
+}
+
+#a {
+	display: block;
+}
+
+#banner {
+	background-size: cover;
+	background-position: center center;
+}
+
+#title {
+	display: inline-block;
+	margin: 24px;
+	padding: 0.5em 0.8em;
+	color: #fff;
+	background: rgba(0, 0, 0, 0.5);
+	font-weight: bold;
+	font-size: 1.3em;
+}
+
+#content {
+	overflow: auto;
+	color: #353c3e;
+}
+
+#description {
+	margin: 24px;
+}
+</style></head><body><a id="a" href="{{.url}}" target="_blank"><header id="banner" style="background-image: url(https://media.s.chars.jp/misskey/3dee2837-c5b9-4d0b-ad1b-da7c34b730b7.jpg)"><div id="title">{{.instanceName}}</div></header></a><div id="content"><div id="description">{{.description}}</div></div></body></html>
\ No newline at end of file
diff -ru cmd/misskey/assets/template/note.tmpl w/template/note.tmpl
--- cmd/misskey/assets/template/note.tmpl	2022-02-26 14:40:00.089504000 +0900
+++ w/template/note.tmpl	2022-02-23 18:46:57.714859000 +0900
@@ -1,14 +1,11 @@
-{{/* const user = note.user; */}}{{/* const title = user.name ? ``+user.name+` (@`+user.username+`)` : `@`+user.username+``; */}}{{/* const url = ``+config.url+`/notes/`+note.id+``; */}}{{/* const isRenote = note.renote && note.text == null && note.fileIds.length == 0 && note.poll == null; */}}<!doctype html>{{ "<!--\n" }}{{ "  _____ _         _           \n" }}{{ " |     |_|___ ___| |_ ___ _ _ \n" }}{{ " | | | | |_ -|_ -| \'_| -_| | |\n" }}{{ " |_|_|_|_|___|___|_,_|___|_  |\n" }}{{ "                         |___|\n" }}{{ " Thank you for using Misskey!\n" }}{{ " If you are reading this message... how about joining the development?\n" }}{{ " https://github.com/misskey-dev/misskey" }}{{ "\n-->\n" }}<meta charset=utf-8><meta name=application-name content="Misskey"><meta name=referrer content="origin"><meta name=theme-color content="#86b300"><meta name=theme-color-orig content="#86b300"><meta property="og:site_name" content="{{ print instanceName || " misskey" }}"><meta name=viewport content="width=device-width,initial-scale=1"><link rel=icon href="{{ print icon ||" /favicon.ico" }}"><link rel=apple-touch-icon href="{{ print icon ||" /apple-touch-icon.png" }}"><link rel=manifest href=/manifest.json><link rel=prefetch href=https://xn--931a.moe/assets/info.jpg><link rel=prefetch href=https://xn--931a.moe/assets/not-found.jpg><link rel=prefetch href=https://xn--931a.moe/assets/error.jpg><link rel=preload href=https://use.fontawesome.com/releases/v5.15.3/css/all.css as=style><link rel=stylesheet href=https://use.fontawesome.com/releases/v5.15.3/css/all.css><title>{{ ``+title+` | `+instanceName+`` }}</title><meta name=description content="{{ print summary }}">{{ if user.host || isRenote || profile.noCrawle }}<meta name=robots content="noindex">{{ end }}<meta name=misskey:user-username content="{{ print user.username }}"><meta name=misskey:user-id content="{{ print user.id }}"><meta name=misskey:note-id content="{{ print note.id }}"><meta name=twitter:card content="summary"><!-- todo -->{{ if user.twitter }}<meta name=twitter:creator content="{{ print `@`+user.twitter.screenName+`` }}">{{ end }}{{ if note.prev }}<link rel=prev href="{{ print ``+config.url+`/notes/`+note.prev+`` }}">{{ end }}{{ if note.next }}<link rel=next href="{{ print ``+config.url+`/notes/`+note.next+`` }}">{{ end }}{{ if !user.host }}<link rel=alternate href="{{ print url }}" type=application/activity+json>{{ end }}{{ if note.uri }}<link rel=alternate href="{{ print note.uri }}" type=application/activity+json>{{ end }}<meta property="og:type" content="article"><meta property="og:title" content="{{ print title }}"><meta property="og:description" content="{{ print summary }}"><meta property="og:url" content="{{ print url }}"><meta property="og:image" content="{{ print user.avatarUrl }}"><style>html{background-color:var(--bg);color:var(--fg)}#splash{position:fixed;z-index:10000;top:0;left:0;width:100vw;height:100vh;cursor:wait;background-color:var(--bg);opacity:1;transition:opacity .5s ease}#splash>img{position:absolute;top:0;right:0;bottom:0;left:0;margin:auto;width:64px;height:64px;pointer-events:none}</style><script>'use strict';(async()=>{window.onerror=e=>{n("SOMETHING_HAPPENED",e.toString())},window.onunhandledrejection=e=>{n("SOMETHING_HAPPENED_IN_PROMISE",e.toString())};const t=localStorage.getItem("v")||VERSION,r=localStorage.getItem("localeVersion"),u=r==null||r!==t;if(!localStorage.hasOwnProperty("locale")||u){const s=LANGS;let e=localStorage.getItem("lang");(e==null||!s.includes(e))&&(s.includes(navigator.language)?e=navigator.language:(e=s.find(e=>e.split("-")[0]===navigator.language),e==null&&(e="en-US")));const o=await fetch(`/assets/locales/${e}.${t}.json`);if(o.status===200)localStorage.setItem("lang",e),localStorage.setItem("locale",await o.text()),localStorage.setItem("localeVersion",t);else{await a(),n("LOCALE_FETCH_FAILED");return}}const d=localStorage.getItem("salt")?`?salt=${localStorage.getItem("salt")}`:'',e=document.createElement("script");e.setAttribute("src",`/assets/app.${t}.js${d}`),e.setAttribute("async","true"),e.setAttribute("defer","true"),e.addEventListener("error",async()=>{await a(),n("APP_FETCH_FAILED")}),document.head.appendChild(e);const i=localStorage.getItem("theme");if(i)for(const[e,t]of Object.entries(JSON.parse(i)))if(document.documentElement.style.setProperty(`--${e}`,t.toString()),e==="htmlThemeColor")for(const e of document.head.children)if(e.tagName==="META"&&e.getAttribute("name")==="theme-color"){e.setAttribute("content",t);break}const o=localStorage.getItem("fontSize");o&&document.documentElement.classList.add("f-"+o);const l=localStorage.getItem("useSystemFont");l&&document.documentElement.classList.add("useSystemFont");const c=localStorage.getItem("wallpaper");c&&(document.documentElement.style.backgroundImage=`url(${c})`);const s=localStorage.getItem("customCss");if(s&&s.length>0){const e=document.createElement("style");e.innerHTML=s,document.head.appendChild(e)}function n(e,t){document.documentElement.innerHTML=`
-			<h1>⚠エラーが発生しました</h1>
-			<p>問題が解決しない場合は管理者までお問い合わせください。以下のオプションを試すこともできます:</p>
-			<ul>
-				<li><a href="/cli">簡易クライアント</a>を起動</li>
-				<li><a href="/bios">BIOS</a>で修復を試みる</li>
-				<li><a href="/flush">キャッシュをクリア</a>する</li>
-			</ul>
-			<hr>
-			<code>ERROR CODE: ${e}</code>
-			<details>
-				${t}
-			</details>
-		`}async function a(){const n=await fetch("/api/meta",{method:"POST",cache:"no-cache"}),e=await n.json();e.version!=t&&(localStorage.setItem("v",e.version),h())}function h(){localStorage.setItem("salt",Math.random().toString().substr(2,8));try{navigator.serviceWorker.controller.postMessage("clear"),navigator.serviceWorker.getRegistrations().then(e=>{e.forEach(e=>e.unregister())})}catch(e){console.error(e)}location.reload()}})()</script><noscript><p>JavaScriptを有効にしてください<br>Please turn on your JavaScript</p></noscript><div id=splash><img src=/favicon.ico></div>
\ No newline at end of file
+<!DOCTYPE html><!--
+  _____ _         _           
+ |     |_|___ ___| |_ ___ _ _ 
+ | | | | |_ -|_ -| '_| -_| | |
+ |_|_|_|_|___|___|_,_|___|_  |
+                         |___|
+ Thank you for using Misskey!
+ If you are reading this message... how about joining the development?
+ https://github.com/misskey-dev/misskey
+-->
+<html><head><meta charset="utf-8"><meta name="application-name" content="Misskey"><meta name="referrer" content="origin"><meta name="theme-color" content="#86b300"><meta name="theme-color-orig" content="#86b300"><meta property="og:site_name" content="{{.instanceName}}"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="{{.icon}}"><link rel="apple-touch-icon" href="{{.iconApple}}"><link rel="manifest" href="/manifest.json"><link rel="prefetch" href="https://xn--931a.moe/assets/info.jpg"><link rel="prefetch" href="https://xn--931a.moe/assets/not-found.jpg"><link rel="prefetch" href="https://xn--931a.moe/assets/error.jpg"><link rel="preload" href="https://use.fontawesome.com/releases/v5.15.3/css/all.css" as="style"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.3/css/all.css"><title>{{.userReference}} | {{.instanceName}}</title><meta name="description" content="{{.summary}}">{{if .noIndex}}<meta name="robots" content="noindex"/>{{end}}<meta name="misskey:user-username" content="{{.userUsername}}"><meta name="misskey:user-id" content="{{.userID}}"><meta name="misskey:note-id" content="{{.noteID}}"><meta name="twitter:card" content="summary"><!-- todo-->{{if .userTwitterExists}}<meta name="twitter:creator" content="@{{.userTwitterScreenName}}"/>{{end}}{{if .notePrevExists}}<link rel="prev" href="{{.url}}/notes/{{.notePrev}}"/>{{end}}{{if .noteNextExists}}<link rel="next" href="{{.url}}/notes/{{.noteNext}}"/>{{end}}{{if .localUser}}<link rel="alternate" href="{{.url}}/notes/{{.noteID}}" type="application/activity+json">{{end}}{{if .remoteNote}}<link rel="alternate" href="{{.noteURI}}" type="application/activity+json"/>{{end}}<meta property="og:type" content="article"><meta property="og:title" content="{{.userReference}}"><meta property="og:description" content="{{.summary}}"><meta property="og:url" content="{{.url}}/notes/{{.noteID}}"><meta property="og:image" content="{{.userAvatarURL}}"><style>html{background-color:var(--bg);color:var(--fg)}#splash{position:fixed;z-index:10000;top:0;left:0;width:100vw;height:100vh;cursor:wait;background-color:var(--bg);opacity:1;transition:opacity .5s ease}#splash>img{position:absolute;top:0;right:0;bottom:0;left:0;margin:auto;width:64px;height:64px;pointer-events:none}</style><script>"use strict";(async()=>{window.onerror=t=>{i("SOMETHING_HAPPENED",t.toString())},window.onunhandledrejection=t=>{i("SOMETHING_HAPPENED_IN_PROMISE",t.toString())};const t=localStorage.getItem("v")||"12.101.1",e=localStorage.getItem("localeVersion"),a=null==e||e!==t;if(!localStorage.hasOwnProperty("locale")||a){const e=["ar-SA","cs-CZ","da-DK","de-DE","en-US","eo-UY","es-ES","fr-FR","id-ID","it-IT","ja-JP","ja-KS","kab-KAB","kn-IN","ko-KR","nl-NL","no-NO","pl-PL","pt-PT","ru-RU","ug-CN","uk-UA","zh-CN","zh-TW"];let a=localStorage.getItem("lang");null!=a&&e.includes(a)||(e.includes(navigator.language)?a=navigator.language:(a=e.find((t=>t.split("-")[0]===navigator.language)),null==a&&(a="en-US")));const o=await fetch(`/assets/locales/${a}.${t}.json`);if(200!==o.status)return await g(),void i("LOCALE_FETCH_FAILED");localStorage.setItem("lang",a),localStorage.setItem("locale",await o.text()),localStorage.setItem("localeVersion",t)}const o=localStorage.getItem("salt")?`?salt=${localStorage.getItem("salt")}`:"",n=document.createElement("script");n.setAttribute("src",`/assets/app.${t}.js${o}`),n.setAttribute("async","true"),n.setAttribute("defer","true"),n.addEventListener("error",(async()=>{await g(),i("APP_FETCH_FAILED")})),document.head.appendChild(n);const l=localStorage.getItem("theme");if(l)for(const[t,e]of Object.entries(JSON.parse(l)))if(document.documentElement.style.setProperty(`--${t}`,e.toString()),"htmlThemeColor"===t)for(const t of document.head.children)if("META"===t.tagName&&"theme-color"===t.getAttribute("name")){t.setAttribute("content",e);break}const r=localStorage.getItem("fontSize");r&&document.documentElement.classList.add("f-"+r);localStorage.getItem("useSystemFont")&&document.documentElement.classList.add("useSystemFont");const c=localStorage.getItem("wallpaper");c&&(document.documentElement.style.backgroundImage=`url(${c})`);const s=localStorage.getItem("customCss");if(s&&s.length>0){const t=document.createElement("style");t.innerHTML=s,document.head.appendChild(t)}function i(t,e){document.documentElement.innerHTML=`\n\t\t\t<h1>⚠エラーが発生しました</h1>\n\t\t\t<p>問題が解決しない場合は管理者までお問い合わせください。以下のオプションを試すこともできます:</p>\n\t\t\t<ul>\n\t\t\t\t<li><a href="/cli">簡易クライアント</a>を起動</li>\n\t\t\t\t<li><a href="/bios">BIOS</a>で修復を試みる</li>\n\t\t\t\t<li><a href="/flush">キャッシュをクリア</a>する</li>\n\t\t\t</ul>\n\t\t\t<hr>\n\t\t\t<code>ERROR CODE: ${t}</code>\n\t\t\t<details>\n\t\t\t\t${e}\n\t\t\t</details>\n\t\t`}async function g(){const e=await fetch("/api/meta",{method:"POST",cache:"no-cache"}),a=await e.json();a.version!=t&&(localStorage.setItem("v",a.version),function(){localStorage.setItem("salt",Math.random().toString().substr(2,8));try{navigator.serviceWorker.controller.postMessage("clear"),navigator.serviceWorker.getRegistrations().then((t=>{t.forEach((t=>t.unregister()))}))}catch(t){console.error(t)}location.reload()}())}})();</script></head><body><noscript><p>JavaScriptを有効にしてください<br>Please turn on your JavaScript</p></noscript><div id="splash"><img src="/favicon.ico"></div></body></html>
\ No newline at end of file
diff -ru cmd/misskey/assets/template/page.tmpl w/template/page.tmpl
--- cmd/misskey/assets/template/page.tmpl	2022-02-26 14:40:00.090769000 +0900
+++ w/template/page.tmpl	2022-02-26 14:13:38.646103000 +0900
@@ -1,14 +1,11 @@
-{{/* const user = page.user; */}}{{/* const title = page.title; */}}{{/* const url = ``+config.url+`/@`+user.username+`/`+page.name+``; */}}<!doctype html>{{ "<!--\n" }}{{ "  _____ _         _           \n" }}{{ " |     |_|___ ___| |_ ___ _ _ \n" }}{{ " | | | | |_ -|_ -| \'_| -_| | |\n" }}{{ " |_|_|_|_|___|___|_,_|___|_  |\n" }}{{ "                         |___|\n" }}{{ " Thank you for using Misskey!\n" }}{{ " If you are reading this message... how about joining the development?\n" }}{{ " https://github.com/misskey-dev/misskey" }}{{ "\n-->\n" }}<meta charset=utf-8><meta name=application-name content="Misskey"><meta name=referrer content="origin"><meta name=theme-color content="#86b300"><meta name=theme-color-orig content="#86b300"><meta property="og:site_name" content="{{ print instanceName || " misskey" }}"><meta name=viewport content="width=device-width,initial-scale=1"><link rel=icon href="{{ print icon ||" /favicon.ico" }}"><link rel=apple-touch-icon href="{{ print icon ||" /apple-touch-icon.png" }}"><link rel=manifest href=/manifest.json><link rel=prefetch href=https://xn--931a.moe/assets/info.jpg><link rel=prefetch href=https://xn--931a.moe/assets/not-found.jpg><link rel=prefetch href=https://xn--931a.moe/assets/error.jpg><link rel=preload href=https://use.fontawesome.com/releases/v5.15.3/css/all.css as=style><link rel=stylesheet href=https://use.fontawesome.com/releases/v5.15.3/css/all.css><title>{{ ``+title+` | `+instanceName+`` }}</title><meta name=description content="{{ print page.summary }}">{{ if profile.noCrawle }}<meta name=robots content="noindex">{{ end }}<meta name=misskey:user-username content="{{ print user.username }}"><meta name=misskey:user-id content="{{ print user.id }}"><meta name=misskey:page-id content="{{ print page.id }}"><meta name=twitter:card content="summary"><!-- todo -->{{ if user.twitter }}<meta name=twitter:creator content="{{ print `@`+user.twitter.screenName+`` }}">{{ end }}<meta property="og:type" content="article"><meta property="og:title" content="{{ print title }}"><meta property="og:description" content="{{ print page.summary }}"><meta property="og:url" content="{{ print url }}"><meta property="og:image" content="{{ print page.eyeCatchingImage ? page.eyeCatchingImage.thumbnailUrl : user.avatarUrl }}"><style>html{background-color:var(--bg);color:var(--fg)}#splash{position:fixed;z-index:10000;top:0;left:0;width:100vw;height:100vh;cursor:wait;background-color:var(--bg);opacity:1;transition:opacity .5s ease}#splash>img{position:absolute;top:0;right:0;bottom:0;left:0;margin:auto;width:64px;height:64px;pointer-events:none}</style><script>'use strict';(async()=>{window.onerror=e=>{n("SOMETHING_HAPPENED",e.toString())},window.onunhandledrejection=e=>{n("SOMETHING_HAPPENED_IN_PROMISE",e.toString())};const t=localStorage.getItem("v")||VERSION,r=localStorage.getItem("localeVersion"),u=r==null||r!==t;if(!localStorage.hasOwnProperty("locale")||u){const s=LANGS;let e=localStorage.getItem("lang");(e==null||!s.includes(e))&&(s.includes(navigator.language)?e=navigator.language:(e=s.find(e=>e.split("-")[0]===navigator.language),e==null&&(e="en-US")));const o=await fetch(`/assets/locales/${e}.${t}.json`);if(o.status===200)localStorage.setItem("lang",e),localStorage.setItem("locale",await o.text()),localStorage.setItem("localeVersion",t);else{await a(),n("LOCALE_FETCH_FAILED");return}}const d=localStorage.getItem("salt")?`?salt=${localStorage.getItem("salt")}`:'',e=document.createElement("script");e.setAttribute("src",`/assets/app.${t}.js${d}`),e.setAttribute("async","true"),e.setAttribute("defer","true"),e.addEventListener("error",async()=>{await a(),n("APP_FETCH_FAILED")}),document.head.appendChild(e);const i=localStorage.getItem("theme");if(i)for(const[e,t]of Object.entries(JSON.parse(i)))if(document.documentElement.style.setProperty(`--${e}`,t.toString()),e==="htmlThemeColor")for(const e of document.head.children)if(e.tagName==="META"&&e.getAttribute("name")==="theme-color"){e.setAttribute("content",t);break}const o=localStorage.getItem("fontSize");o&&document.documentElement.classList.add("f-"+o);const l=localStorage.getItem("useSystemFont");l&&document.documentElement.classList.add("useSystemFont");const c=localStorage.getItem("wallpaper");c&&(document.documentElement.style.backgroundImage=`url(${c})`);const s=localStorage.getItem("customCss");if(s&&s.length>0){const e=document.createElement("style");e.innerHTML=s,document.head.appendChild(e)}function n(e,t){document.documentElement.innerHTML=`
-			<h1>⚠エラーが発生しました</h1>
-			<p>問題が解決しない場合は管理者までお問い合わせください。以下のオプションを試すこともできます:</p>
-			<ul>
-				<li><a href="/cli">簡易クライアント</a>を起動</li>
-				<li><a href="/bios">BIOS</a>で修復を試みる</li>
-				<li><a href="/flush">キャッシュをクリア</a>する</li>
-			</ul>
-			<hr>
-			<code>ERROR CODE: ${e}</code>
-			<details>
-				${t}
-			</details>
-		`}async function a(){const n=await fetch("/api/meta",{method:"POST",cache:"no-cache"}),e=await n.json();e.version!=t&&(localStorage.setItem("v",e.version),h())}function h(){localStorage.setItem("salt",Math.random().toString().substr(2,8));try{navigator.serviceWorker.controller.postMessage("clear"),navigator.serviceWorker.getRegistrations().then(e=>{e.forEach(e=>e.unregister())})}catch(e){console.error(e)}location.reload()}})()</script><noscript><p>JavaScriptを有効にしてください<br>Please turn on your JavaScript</p></noscript><div id=splash><img src=/favicon.ico></div>
\ No newline at end of file
+<!DOCTYPE html><!--
+  _____ _         _           
+ |     |_|___ ___| |_ ___ _ _ 
+ | | | | |_ -|_ -| '_| -_| | |
+ |_|_|_|_|___|___|_,_|___|_  |
+                         |___|
+ Thank you for using Misskey!
+ If you are reading this message... how about joining the development?
+ https://github.com/misskey-dev/misskey
+-->
+<html><head><meta charset="utf-8"><meta name="application-name" content="Misskey"><meta name="referrer" content="origin"><meta name="theme-color" content="#86b300"><meta name="theme-color-orig" content="#86b300"><meta property="og:site_name" content="{{.instanceName}}"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="{{.icon}}"><link rel="apple-touch-icon" href="{{.iconApple}}"><link rel="manifest" href="/manifest.json"><link rel="prefetch" href="https://xn--931a.moe/assets/info.jpg"><link rel="prefetch" href="https://xn--931a.moe/assets/not-found.jpg"><link rel="prefetch" href="https://xn--931a.moe/assets/error.jpg"><link rel="preload" href="https://use.fontawesome.com/releases/v5.15.3/css/all.css" as="style"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.3/css/all.css"><title>{{.pageTitle}} | {{.instanceName}}</title><meta name="description" content="{{.pageSummary}}">{{if .noCrawl}}<meta name="robots" content="noindex"/>{{end}}<meta name="misskey:user-username" content="{{.userUsername}}"><meta name="misskey:user-id" content="{{.userID}}"><meta name="misskey:page-id" content="{{.pageID}}"><meta name="twitter:card" content="summary"><!-- todo-->{{if .userTwitterExists}}<meta name="twitter:creator" content="@{{.userTwitterScreenName}}"/>{{end}}<meta property="og:type" content="article"><meta property="og:title" content="{{.pageTitle}}"><meta property="og:description" content="{{.pageSummary}}"><meta property="og:url" content="{{.url}}/@{{.userUsername}}/{{.pageName}}"><meta property="og:image" content="{{.image}}"><style>html{background-color:var(--bg);color:var(--fg)}#splash{position:fixed;z-index:10000;top:0;left:0;width:100vw;height:100vh;cursor:wait;background-color:var(--bg);opacity:1;transition:opacity .5s ease}#splash>img{position:absolute;top:0;right:0;bottom:0;left:0;margin:auto;width:64px;height:64px;pointer-events:none}</style><script>"use strict";(async()=>{window.onerror=t=>{i("SOMETHING_HAPPENED",t.toString())},window.onunhandledrejection=t=>{i("SOMETHING_HAPPENED_IN_PROMISE",t.toString())};const t=localStorage.getItem("v")||"12.101.1",e=localStorage.getItem("localeVersion"),a=null==e||e!==t;if(!localStorage.hasOwnProperty("locale")||a){const e=["ar-SA","cs-CZ","da-DK","de-DE","en-US","eo-UY","es-ES","fr-FR","id-ID","it-IT","ja-JP","ja-KS","kab-KAB","kn-IN","ko-KR","nl-NL","no-NO","pl-PL","pt-PT","ru-RU","ug-CN","uk-UA","zh-CN","zh-TW"];let a=localStorage.getItem("lang");null!=a&&e.includes(a)||(e.includes(navigator.language)?a=navigator.language:(a=e.find((t=>t.split("-")[0]===navigator.language)),null==a&&(a="en-US")));const o=await fetch(`/assets/locales/${a}.${t}.json`);if(200!==o.status)return await g(),void i("LOCALE_FETCH_FAILED");localStorage.setItem("lang",a),localStorage.setItem("locale",await o.text()),localStorage.setItem("localeVersion",t)}const o=localStorage.getItem("salt")?`?salt=${localStorage.getItem("salt")}`:"",n=document.createElement("script");n.setAttribute("src",`/assets/app.${t}.js${o}`),n.setAttribute("async","true"),n.setAttribute("defer","true"),n.addEventListener("error",(async()=>{await g(),i("APP_FETCH_FAILED")})),document.head.appendChild(n);const l=localStorage.getItem("theme");if(l)for(const[t,e]of Object.entries(JSON.parse(l)))if(document.documentElement.style.setProperty(`--${t}`,e.toString()),"htmlThemeColor"===t)for(const t of document.head.children)if("META"===t.tagName&&"theme-color"===t.getAttribute("name")){t.setAttribute("content",e);break}const r=localStorage.getItem("fontSize");r&&document.documentElement.classList.add("f-"+r);localStorage.getItem("useSystemFont")&&document.documentElement.classList.add("useSystemFont");const c=localStorage.getItem("wallpaper");c&&(document.documentElement.style.backgroundImage=`url(${c})`);const s=localStorage.getItem("customCss");if(s&&s.length>0){const t=document.createElement("style");t.innerHTML=s,document.head.appendChild(t)}function i(t,e){document.documentElement.innerHTML=`\n\t\t\t<h1>⚠エラーが発生しました</h1>\n\t\t\t<p>問題が解決しない場合は管理者までお問い合わせください。以下のオプションを試すこともできます:</p>\n\t\t\t<ul>\n\t\t\t\t<li><a href="/cli">簡易クライアント</a>を起動</li>\n\t\t\t\t<li><a href="/bios">BIOS</a>で修復を試みる</li>\n\t\t\t\t<li><a href="/flush">キャッシュをクリア</a>する</li>\n\t\t\t</ul>\n\t\t\t<hr>\n\t\t\t<code>ERROR CODE: ${t}</code>\n\t\t\t<details>\n\t\t\t\t${e}\n\t\t\t</details>\n\t\t`}async function g(){const e=await fetch("/api/meta",{method:"POST",cache:"no-cache"}),a=await e.json();a.version!=t&&(localStorage.setItem("v",a.version),function(){localStorage.setItem("salt",Math.random().toString().substr(2,8));try{navigator.serviceWorker.controller.postMessage("clear"),navigator.serviceWorker.getRegistrations().then((t=>{t.forEach((t=>t.unregister()))}))}catch(t){console.error(t)}location.reload()}())}})();</script></head><body><noscript><p>JavaScriptを有効にしてください<br>Please turn on your JavaScript</p></noscript><div id="splash"><img src="/favicon.ico"></div></body></html>
\ No newline at end of file
diff -ru cmd/misskey/assets/template/user.tmpl w/template/user.tmpl
--- cmd/misskey/assets/template/user.tmpl	2022-02-26 14:40:00.092229000 +0900
+++ w/template/user.tmpl	2022-02-26 14:39:49.794571000 +0900
@@ -1,14 +1,11 @@
-{{/* const title = user.name ? ``+user.name+` (@`+user.username+`)` : `@`+user.username+``; */}}{{/* const url = ``+config.url+`/@`+(user.host ? `${user.username}@${user.host}` : user.username)+``; */}}{{/* const img = user.avatarUrl || null; */}}<!doctype html>{{ "<!--\n" }}{{ "  _____ _         _           \n" }}{{ " |     |_|___ ___| |_ ___ _ _ \n" }}{{ " | | | | |_ -|_ -| \'_| -_| | |\n" }}{{ " |_|_|_|_|___|___|_,_|___|_  |\n" }}{{ "                         |___|\n" }}{{ " Thank you for using Misskey!\n" }}{{ " If you are reading this message... how about joining the development?\n" }}{{ " https://github.com/misskey-dev/misskey" }}{{ "\n-->\n" }}<meta charset=utf-8><meta name=application-name content="Misskey"><meta name=referrer content="origin"><meta name=theme-color content="#86b300"><meta name=theme-color-orig content="#86b300"><meta property="og:site_name" content="{{ print instanceName || " misskey" }}"><meta name=viewport content="width=device-width,initial-scale=1"><link rel=icon href="{{ print icon ||" /favicon.ico" }}"><link rel=apple-touch-icon href="{{ print icon ||" /apple-touch-icon.png" }}"><link rel=manifest href=/manifest.json><link rel=prefetch href=https://xn--931a.moe/assets/info.jpg><link rel=prefetch href=https://xn--931a.moe/assets/not-found.jpg><link rel=prefetch href=https://xn--931a.moe/assets/error.jpg><link rel=preload href=https://use.fontawesome.com/releases/v5.15.3/css/all.css as=style><link rel=stylesheet href=https://use.fontawesome.com/releases/v5.15.3/css/all.css><title>{{ ``+title+` | `+instanceName+`` }}</title><meta name=description content="{{ print profile.description }}">{{ if user.host || profile.noCrawle }}<meta name=robots content="noindex">{{ end }}<meta name=misskey:user-username content="{{ print user.username }}"><meta name=misskey:user-id content="{{ print user.id }}"><meta name=twitter:card content="summary">{{ if profile.twitter }}<meta name=twitter:creator content="{{ print `@`+profile.twitter.screenName+`` }}">{{ end }}{{ if !sub }}{{ if !user.host }}<link rel=alternate href="{{ print ``+config.url+`/users/`+user.id+`` }}" type=application/activity+json>{{ end }}{{ if user.uri }}<link rel=alternate href="{{ print user.uri }}" type=application/activity+json>{{ end }}{{ if profile.url }}<link rel=alternate href="{{ print profile.url }}" type=text/html>{{ end }}{{ end }}{{/* _, m */}}{{ range me }}<link rel=me href="{{ print ``+m+`` }}">{{ end }}<meta property="og:type" content="blog"><meta property="og:title" content="{{ print title }}"><meta property="og:description" content="{{ print profile.description }}"><meta property="og:url" content="{{ print url }}"><meta property="og:image" content="{{ print img }}"><style>html{background-color:var(--bg);color:var(--fg)}#splash{position:fixed;z-index:10000;top:0;left:0;width:100vw;height:100vh;cursor:wait;background-color:var(--bg);opacity:1;transition:opacity .5s ease}#splash>img{position:absolute;top:0;right:0;bottom:0;left:0;margin:auto;width:64px;height:64px;pointer-events:none}</style><script>'use strict';(async()=>{window.onerror=e=>{n("SOMETHING_HAPPENED",e.toString())},window.onunhandledrejection=e=>{n("SOMETHING_HAPPENED_IN_PROMISE",e.toString())};const t=localStorage.getItem("v")||VERSION,r=localStorage.getItem("localeVersion"),u=r==null||r!==t;if(!localStorage.hasOwnProperty("locale")||u){const s=LANGS;let e=localStorage.getItem("lang");(e==null||!s.includes(e))&&(s.includes(navigator.language)?e=navigator.language:(e=s.find(e=>e.split("-")[0]===navigator.language),e==null&&(e="en-US")));const o=await fetch(`/assets/locales/${e}.${t}.json`);if(o.status===200)localStorage.setItem("lang",e),localStorage.setItem("locale",await o.text()),localStorage.setItem("localeVersion",t);else{await a(),n("LOCALE_FETCH_FAILED");return}}const d=localStorage.getItem("salt")?`?salt=${localStorage.getItem("salt")}`:'',e=document.createElement("script");e.setAttribute("src",`/assets/app.${t}.js${d}`),e.setAttribute("async","true"),e.setAttribute("defer","true"),e.addEventListener("error",async()=>{await a(),n("APP_FETCH_FAILED")}),document.head.appendChild(e);const i=localStorage.getItem("theme");if(i)for(const[e,t]of Object.entries(JSON.parse(i)))if(document.documentElement.style.setProperty(`--${e}`,t.toString()),e==="htmlThemeColor")for(const e of document.head.children)if(e.tagName==="META"&&e.getAttribute("name")==="theme-color"){e.setAttribute("content",t);break}const o=localStorage.getItem("fontSize");o&&document.documentElement.classList.add("f-"+o);const l=localStorage.getItem("useSystemFont");l&&document.documentElement.classList.add("useSystemFont");const c=localStorage.getItem("wallpaper");c&&(document.documentElement.style.backgroundImage=`url(${c})`);const s=localStorage.getItem("customCss");if(s&&s.length>0){const e=document.createElement("style");e.innerHTML=s,document.head.appendChild(e)}function n(e,t){document.documentElement.innerHTML=`
-			<h1>⚠エラーが発生しました</h1>
-			<p>問題が解決しない場合は管理者までお問い合わせください。以下のオプションを試すこともできます:</p>
-			<ul>
-				<li><a href="/cli">簡易クライアント</a>を起動</li>
-				<li><a href="/bios">BIOS</a>で修復を試みる</li>
-				<li><a href="/flush">キャッシュをクリア</a>する</li>
-			</ul>
-			<hr>
-			<code>ERROR CODE: ${e}</code>
-			<details>
-				${t}
-			</details>
-		`}async function a(){const n=await fetch("/api/meta",{method:"POST",cache:"no-cache"}),e=await n.json();e.version!=t&&(localStorage.setItem("v",e.version),h())}function h(){localStorage.setItem("salt",Math.random().toString().substr(2,8));try{navigator.serviceWorker.controller.postMessage("clear"),navigator.serviceWorker.getRegistrations().then(e=>{e.forEach(e=>e.unregister())})}catch(e){console.error(e)}location.reload()}})()</script><noscript><p>JavaScriptを有効にしてください<br>Please turn on your JavaScript</p></noscript><div id=splash><img src=/favicon.ico></div>
\ No newline at end of file
+<!DOCTYPE html><!--
+  _____ _         _           
+ |     |_|___ ___| |_ ___ _ _ 
+ | | | | |_ -|_ -| '_| -_| | |
+ |_|_|_|_|___|___|_,_|___|_  |
+                         |___|
+ Thank you for using Misskey!
+ If you are reading this message... how about joining the development?
+ https://github.com/misskey-dev/misskey
+-->
+<html><head><meta charset="utf-8"><meta name="application-name" content="Misskey"><meta name="referrer" content="origin"><meta name="theme-color" content="#86b300"><meta name="theme-color-orig" content="#86b300"><meta property="og:site_name" content="{{.instanceName}}"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="{{.icon}}"><link rel="apple-touch-icon" href="{{.iconApple}}"><link rel="manifest" href="/manifest.json"><link rel="prefetch" href="https://xn--931a.moe/assets/info.jpg"><link rel="prefetch" href="https://xn--931a.moe/assets/not-found.jpg"><link rel="prefetch" href="https://xn--931a.moe/assets/error.jpg"><link rel="preload" href="https://use.fontawesome.com/releases/v5.15.3/css/all.css" as="style"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.3/css/all.css"><title>{{.userReference}} | {{.instanceName}}</title><meta name="description" content="{{.profileDescription}}">{{if .noIndex}}<meta name="robots" content="noindex"/>{{end}}<meta name="misskey:user-username" content="{{.userUsername}}"><meta name="misskey:user-id" content="{{.userID}}"><meta name="twitter:card" content="summary">{{if .userTwitterExists}}<meta name="twitter:creator" content="@{{.userTwitterScreenName}}"/>{{end}}{{if .atRoot}}{{if .localUser}}<link rel="alternate" href="{{.url}}/users/{{.userID}}" type="application/activity+json"/>{{end}}{{if .hasUserURI}}<link rel="alternate" href="{{.userURI}}" type="application/activity+json"/>{{end}}{{if .hasProfileURL}}<link rel="alternate" href="{{.profileURL}}" type="text/html"/>{{end}}{{end}}{{range .me}}<link rel="me" href="{{.}}"/>{{end}}<meta property="og:type" content="blog"><meta property="og:title" content="{{.userReference}}"><meta property="og:description" content="{{.profileDescription}}"><meta property="og:url" content="{{.url}}/@{{.userFull}}"><meta property="og:image" content="{{.userAvatarURL}}"><style>html{background-color:var(--bg);color:var(--fg)}#splash{position:fixed;z-index:10000;top:0;left:0;width:100vw;height:100vh;cursor:wait;background-color:var(--bg);opacity:1;transition:opacity .5s ease}#splash>img{position:absolute;top:0;right:0;bottom:0;left:0;margin:auto;width:64px;height:64px;pointer-events:none}</style><script>"use strict";(async()=>{window.onerror=t=>{i("SOMETHING_HAPPENED",t.toString())},window.onunhandledrejection=t=>{i("SOMETHING_HAPPENED_IN_PROMISE",t.toString())};const t=localStorage.getItem("v")||"12.101.1",e=localStorage.getItem("localeVersion"),a=null==e||e!==t;if(!localStorage.hasOwnProperty("locale")||a){const e=["ar-SA","cs-CZ","da-DK","de-DE","en-US","eo-UY","es-ES","fr-FR","id-ID","it-IT","ja-JP","ja-KS","kab-KAB","kn-IN","ko-KR","nl-NL","no-NO","pl-PL","pt-PT","ru-RU","ug-CN","uk-UA","zh-CN","zh-TW"];let a=localStorage.getItem("lang");null!=a&&e.includes(a)||(e.includes(navigator.language)?a=navigator.language:(a=e.find((t=>t.split("-")[0]===navigator.language)),null==a&&(a="en-US")));const o=await fetch(`/assets/locales/${a}.${t}.json`);if(200!==o.status)return await g(),void i("LOCALE_FETCH_FAILED");localStorage.setItem("lang",a),localStorage.setItem("locale",await o.text()),localStorage.setItem("localeVersion",t)}const o=localStorage.getItem("salt")?`?salt=${localStorage.getItem("salt")}`:"",n=document.createElement("script");n.setAttribute("src",`/assets/app.${t}.js${o}`),n.setAttribute("async","true"),n.setAttribute("defer","true"),n.addEventListener("error",(async()=>{await g(),i("APP_FETCH_FAILED")})),document.head.appendChild(n);const l=localStorage.getItem("theme");if(l)for(const[t,e]of Object.entries(JSON.parse(l)))if(document.documentElement.style.setProperty(`--${t}`,e.toString()),"htmlThemeColor"===t)for(const t of document.head.children)if("META"===t.tagName&&"theme-color"===t.getAttribute("name")){t.setAttribute("content",e);break}const r=localStorage.getItem("fontSize");r&&document.documentElement.classList.add("f-"+r);localStorage.getItem("useSystemFont")&&document.documentElement.classList.add("useSystemFont");const c=localStorage.getItem("wallpaper");c&&(document.documentElement.style.backgroundImage=`url(${c})`);const s=localStorage.getItem("customCss");if(s&&s.length>0){const t=document.createElement("style");t.innerHTML=s,document.head.appendChild(t)}function i(t,e){document.documentElement.innerHTML=`\n\t\t\t<h1>⚠エラーが発生しました</h1>\n\t\t\t<p>問題が解決しない場合は管理者までお問い合わせください。以下のオプションを試すこともできます:</p>\n\t\t\t<ul>\n\t\t\t\t<li><a href="/cli">簡易クライアント</a>を起動</li>\n\t\t\t\t<li><a href="/bios">BIOS</a>で修復を試みる</li>\n\t\t\t\t<li><a href="/flush">キャッシュをクリア</a>する</li>\n\t\t\t</ul>\n\t\t\t<hr>\n\t\t\t<code>ERROR CODE: ${t}</code>\n\t\t\t<details>\n\t\t\t\t${e}\n\t\t\t</details>\n\t\t`}async function g(){const e=await fetch("/api/meta",{method:"POST",cache:"no-cache"}),a=await e.json();a.version!=t&&(localStorage.setItem("v",a.version),function(){localStorage.setItem("salt",Math.random().toString().substr(2,8));try{navigator.serviceWorker.controller.postMessage("clear"),navigator.serviceWorker.getRegistrations().then((t=>{t.forEach((t=>t.unregister()))}))}catch(t){console.error(t)}location.reload()}())}})();</script></head><body><noscript><p>JavaScriptを有効にしてください<br>Please turn on your JavaScript</p></noscript><div id="splash"><img src="/favicon.ico"></div></body></html>
\ No newline at end of file
